<?xml version="1.0" encoding="UTF-8"?>
<!--
 * This file is subject to the terms and conditions defined in file LICENSE,
 * which is part of this source code package.
 *
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
-->

<xwikidoc version="1.1">
  <web>PhenoTips</web>
  <name>FamilyGroupSheetMacros</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1503000408000</creationDate>
  <parent>PhenoTips.PatientSheet</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1503004883000</date>
  <contentUpdateDate>1503003931000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{include reference="PhenoTips.FamilyGroupSheetCode" /}}

{{velocity}}
##
## FAMILY GROUPS TABLE IN THE FAMILY DASHBOARD
##
#macro (displayFamilyTableHeaderRow)
{{html wiki=true clean=false}}
  &lt;tr&gt;
    &lt;th scope="col" class="button-col"&gt;&lt;/th&gt;
    &lt;th scope="col"&gt;Family ID&lt;/th&gt;
    &lt;th scope="col"&gt;External ID&lt;/th&gt;
    &lt;th scope="col" class="button-col"&gt;&lt;/th&gt;
  &lt;/tr&gt;
{{/html}}
#end
##
#macro (displayFamilyInfoRow $family $mode)
{{html wiki=true clean=false}}
  &lt;tr&gt;
    &lt;td&gt;&lt;/td&gt;
    &lt;td&gt;&lt;a href="$xwiki.getURL(${family.getDocumentReference()})"&gt;$family.getId()&lt;/a&gt;&lt;/td&gt;
    &lt;td&gt;$family.getExternalId()&lt;/td&gt;
    &lt;td&gt;#if ($xcontext.action == 'edit' || $mode == 'edit') #displayRemoveButton() #end&lt;/td&gt;
  &lt;/tr&gt;
{{/html}}
#end
##
#macro (displayAddButton)
#set ($addLink = $doc.getURL() + '?xaction=addfamilyrow&amp;xpage=plain&amp;fgid=')
{{html wiki=false clean=false}}
  &lt;span class="buttonwrapper"&gt;
    &lt;a class="action-add fa fa-plus secondary" href="$!{addLink}" title="Add family to family group"&gt;&lt;/a&gt;
  &lt;/span&gt;
{{/html}}
#end
##
#macro (displayRemoveButton)
{{html wiki=false clean=false}}
  &lt;div class="buttonwrapper"&gt;
    &lt;a class="action-delete fa fa-times secondary" href="" title="Remove family from family group"&gt;&lt;/a&gt;
  &lt;/div&gt;
{{/html}}
#end
##
#macro (displayAutoSuggestInput)
{{html wiki=false clean=false}}
  &lt;span class="auto-suggest-families"&gt;
    &lt;input type="text" placeholder="Enter a family name or id" value="" id="families-search-input" class="families-search-input"&gt;
  &lt;/span&gt;
{{/html}}
#end
##
#macro (displayFamiliesTable $families)
{{html wiki=true clean=false}}
  &lt;table class="families"&gt;
    &lt;tbody&gt;
      #displayFamilyTableHeaderRow()
      #foreach ($family in $families)
        #displayFamilyInfoRow($family)
      #end
    &lt;/tbody&gt;
  &lt;/table&gt;
{{/html}}
#end
##
## FOR REQUESTS - DISPLAY ROW BY ID
##
#macro (displayFamilyRowById $familyId)
  #if ($familyId != '')
    #displayFamilyInfoRow($services.families.getFamilyById($familyId) 'edit')
  #end
#end
##
## DISPLAY FAMILY GROUPS SECTION
##
#macro (displayFamiliesSection)
  ## FamilyGroupSheetCode JSX and SSX needs to be included for this section to work!
  #set ($familyIds = $services.familygroups.getFamilyIdsInFamilyGroup($doc.getName()))
  #set ($families = [])
  #foreach ($familyId in $familyIds) 
    #set ($discard = $families.add($services.families.getFamilyById($familyId)))
  #end
  #if ($xcontext.action == 'edit' || $families != [])
    {{html wiki=true clean=false}}
    &lt;div class="families-section"&gt;
      #if ($xcontext.action == 'edit' || $xcontext.action == 'inline')
        #displayAddToTable('add-family' $families)
      #end
      #displayFamiliesTable($families)
    &lt;/div&gt;
    {{/html}}
  #end
#end
##
## DISPLAY ADD TO TABLE
##
#macro (displayAddToTable $className $entities)
  {{html wiki=true clean=false}}
    &lt;div class="${className}" id="${doc.getName()}"&gt;
    Add a family&lt;br&gt;#displayAutoSuggestInput() #displayAddButton()
    &lt;/div&gt;
  {{/html}}
#end
{{/velocity}}</content>
</xwikidoc>
