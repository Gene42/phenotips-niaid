<?xml version="1.0" encoding="UTF-8"?>

<!--
 * This file is subject to the terms and conditions defined in file LICENSE,
 * which is part of this source code package.
 *
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
-->

<xwikidoc version="1.1">
  <web>PhenoTips</web>
  <name>GeneticEvaluationMacros</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1474579928000</creationDate>
  <parent>PhenoTips.PatientSheet</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1474579954000</date>
  <contentUpdateDate>1474579954000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{velocity output=false}}
##
## GENETIC REPORTS DATA
##
#macro (__getPropertyHTMLClassName $hide $hasOtherOption $propertyName)
  #set ($output='')
  #if ($propertyName != '')
    #if ($hide == 'true' &amp;&amp; $hasOtherOption == 'true')
      #set ($output=$output + $propertyName + " hidden otherOption")
    #elseif ($hide == 'true') 
      #set ($output=$output + $propertyName + " hidden")
    #elseif ($hasOtherOption == 'true')
      #set ($output=$output + $propertyName + " otherOption")
    #else
      #set ($output=$output + $propertyName)
    #end
  #end
  {{html clean=false}}
  $output
  {{/html}}
#end
##
##
#macro (__geneticReports_extradata_deleteTool $object $anchor)
  {{html clean="false"}}&lt;span class="buttonwrapper actions"&gt;&lt;a class="action delete-genetic-report tool button secondary" href="$doc.getURL('objectremove', "classname=${object.xWikiClass.name}&amp;amp;classid=${object.number}&amp;amp;xredirect=$escapetool.url($doc.getURL('edit'))&amp;amp;form_token=$!{services.csrf.getToken()}#$!{anchor}")" title="$services.localization.render('phenotips.tableMacros.delete')"&gt;âœ–&lt;/a&gt;&lt;/span&gt;{{/html}}##
#end
##
##
#macro (__geneticReports_extradata_addTool $classname $anchor $options)
{{html clean="false"}}&lt;span class="buttonwrapper"&gt;&lt;label class="create-button-label"&gt;+&lt;/label&gt;&lt;a class="add-genetic-report button add-data-button" href="$doc.getURL('objectadd', "classname=${classname}&amp;amp;${classname}_$!{options.propertyName}=$!escapetool.url($!{options.propertyValue})&amp;amp;xaction=lastreportentry&amp;amp;xredirect=$escapetool.url(${doc.getURL($options.mode)})&amp;amp;propertyName=$!{options.propertyName}&amp;amp;propertyValue=$!escapetool.url($!{options.propertyValue})#foreach($d in $options.defaults.keySet())&amp;amp;${classname}_${escapetool.url($d)}=$!{escapetool.url($options.defaults.get($d))}#end&amp;amp;addedDisplaySheet=$!escapetool.url($!{options.addedDisplaySheet})&amp;amp;form_token=$!{services.csrf.getToken()}#$!{anchor}")" title="$services.localization.render('phenotips.tableMacros.newEntry')"&gt;Add report&lt;/a&gt;&lt;/span&gt;{{/html}}#if ($services.localization.get("$!{classname}_hint")) {{icon name="question-circle" cssClass="xHelpButton" title="$services.localization.render("${classname}_hint").replace('"', '~~~"')"/}}#end#end
##
##
#macro (__geneticReports_displayCompact $dataClassName $options)
  #if (!$options.mode)
    #set ($discard=$options.put('mode', $xcontext.action))
  #end
  #set ($displayMode = $options.mode)
  #if ($options.mode == 'export')#set ($displayMode = 'view')#end
  #set($dataClass = $xwiki.getDocument($dataClassName).xWikiClass)
  #if ($dataClass)
    #set ($evaluationTypeOptions=$dataClass.get('evaluation_type').getListValues())
    #set ($propsWithOtherOption=$dataClass.get('other_props').getListValues())
    #set ($dataObjects = $doc.getObjects($dataClassName))
    #if ($options.mode != 'edit' &amp;&amp; $dataObjects.size() == 0)
      (% class="hint" %)$services.localization.render('phenotips.tableMacros.noObjects')
    #elseif ($options.mode == 'export')
      (% class="genetic-reports extradata-list#if ("$!{options.labels}" == 'true') withLabel#end#if ("$!{options.counter}" == 'true') withCounter#end" id="extradata-list-${dataClassName}#if("$!{options.propertyName}" != '')-$!{options.propertyValue}#end" %)
      #set($count=0)
      #foreach ($o in $dataObjects)
        #set($count=$count+1)
        #set($evaluationTypeMethod='')
        #foreach($prop in $dataClass.properties)
          #if ($prop.getName() == 'filename')
            |= #${count} |= |
            |   **${prop.translatedPrettyName}:** |$doc.display($prop.getName(), $displayMode, $o) |
          #elseif ($prop.getName() == 'evaluation_type')
            #set($evaluationTypeMethod=$o.getProperty('evaluation_type').value)
            |   **${prop.translatedPrettyName}:** |$doc.display($prop.getName(), $displayMode, $o) |
          #elseif ($evaluationTypeOptions.contains($prop.getName()))
            #if ($prop.getName() == $evaluationTypeMethod)
              |   |$doc.display($prop.getName(), $displayMode, $o) |
            #end
          #elseif ($prop.getName() != $options.propertyName)
            |   **${prop.translatedPrettyName}:** |$doc.display($prop.getName(), $displayMode, $o) |
          #end
        #end
      #end## foreach object
    #else
      (% class="genetic-reports extradata-list#if ("$!{options.labels}" == 'true') withLabel#end#if ("$!{options.counter}" == 'true') withCounter#end $!{options.cssClass}" id="extradata-list-${dataClassName}#if("$!{options.propertyName}" != '')-$!{options.propertyValue}#end" %)
      #if ("$!{options.counter}" == 'true')|=(% class="col-label" %)# #end#foreach($prop in $dataClass.properties)|=(% class="col-label $prop.name#if ($prop.name == $options.propertyName) hidden#end" %)$prop.translatedPrettyName#end#if ($options.mode == 'edit')|=(% class="actions" %)
      #else
      ##
      #end
      #foreach ($o in $dataObjects){{html wiki="true" clean="false"}}&lt;tr class="genetic-report ${velocityCount}"&gt;&lt;td&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr class="head-group"&gt;&lt;td class="pseudoindent row-count"&gt;${velocityCount}&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;#if ($options.mode == 'edit')&lt;td class="actions"&gt;#__geneticReports_extradata_deleteTool($o "extradata-${dataClassName}")&lt;/td&gt;#else&lt;td class="pseudoindent"&gt;&lt;/td&gt;#end&lt;/tr&gt;#foreach($prop in $dataClass.properties)#set ($hide="#if ($prop.name == $options.propertyName || ($evaluationTypeOptions.contains($prop.name) &amp;&amp; $prop.name != $o.getProperty('evaluation_type').value))true#else false#end")&lt;tr class="#__getPropertyHTMLClassName($hide $propsWithOtherOption.contains($prop.name) $prop.name)property"&gt;&lt;td class="pseudoindent"&gt;&lt;/td&gt;&lt;th class="${prop.name} property"&gt;#if ("$!{options.labels}" == 'true'){{html clean="false" wiki="true"}}#if ($prop.name == $options.propertyName || $evaluationTypeOptions.contains($prop.name))#else&lt;label&gt;${prop.translatedPrettyName}:&lt;/label&gt;#end{{/html}}&lt;/th&gt;#end&lt;td&gt;$doc.display($prop.getName(), $displayMode, $o)&lt;/td&gt;&lt;/tr&gt;#end&lt;/tbody&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;{{/html}}#end##FOREACH DATAOBJECTS


      #if ($options.mode == 'edit')
        (% class="list-actions" %)(((#__geneticReports_extradata_addTool($dataClassName))))
      #end
    #end## if options.mode
  #end## if dataclass
#end
##
##
#macro (__geneticReports_displayLastEntry $dataClassName $options)
  #set ($dataClass = $xwiki.getDocument($dataClassName).xWikiClass)
  #set ($evaluationTypeOptions=$dataClass.get('evaluation_type').getListValues())
  #set ($propsWithOtherOption=$dataClass.get('other_props').getListValues())
  #set ($objects = $doc.getObjects($dataClassName))
  #if ($objects.size() &gt; 0)
    #set ($o = $objects.get($mathtool.sub($objects.size(), 1)))
    #set($dataClass = $o.xWikiClass)
    {{html wiki="true" clean="false"}}#if ($options.mode == 'edit')&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr class="head-group"&gt;&lt;td class="pseudoindent row-count"&gt;${velocityCount}&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class="actions"&gt;#__geneticReports_extradata_deleteTool($o "extradata-${dataClassName}")&lt;/td&gt;&lt;/tr&gt;#end#foreach($prop in $dataClass.properties)#set ($hide="#if ($prop.name == $options.propertyName || ($evaluationTypeOptions.contains($prop.name) &amp;&amp; $prop.name != $o.getProperty('evaluation_type').value))true#else false#end")&lt;tr class="#__getPropertyHTMLClassName($hide $propsWithOtherOption.contains($prop.name) $prop.name)property"&gt;&lt;td class="pseudoindent"&gt;&lt;/td&gt;&lt;th class="${prop.name} property"&gt;#if ("$!{options.labels}" == 'true'){{html clean="false" wiki="true"}}#if ($prop.name == $options.propertyName || $evaluationTypeOptions.contains($prop.name))#else&lt;label&gt;${prop.translatedPrettyName}:&lt;/label&gt;#end{{/html}}&lt;/th&gt;#end&lt;td&gt;$doc.display($prop.getName(), $options.mode, $o)&lt;/td&gt;&lt;/tr&gt;#end{{/html}}
  #end
#end
{{/velocity}}</content>
</xwikidoc>
